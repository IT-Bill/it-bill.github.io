---
import Layout from '../layouts/Layout.astro';
import { PROJECTS } from '../lib/constants';

const categories = ['All', 'Web Development', 'Machine Learning', 'Data Science', 'Embedded Systems'];

function formatDate(dateString?: string) {
  if (!dateString) return '';
  const date = new Date(dateString);
  return `${date.toLocaleString('en-US', { month: 'short' })}. ${date.getFullYear()}`;
}
---

<Layout title="Projects - Zhanwei ZHANG">
  <div class="container mx-auto px-4 md:px-8 py-12">
    <div class="max-w-4xl mb-12">
      <p class="text-muted-foreground text-lg">
        A collection of my work in web development, machine learning, and data science. 
        Each project represents a unique challenge and solution.
      </p>
    </div>

    <!-- Filter Tabs -->
    <div class="flex flex-wrap gap-2 mb-12" id="filter-tabs">
      {categories.map((category) => (
        <button
          data-category={category}
          class:list={[
            'px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 cursor-pointer filter-btn',
            category === 'All'
              ? 'bg-primary text-primary-foreground shadow-lg shadow-primary/25'
              : 'bg-card text-muted-foreground hover:bg-muted/60 hover:text-foreground'
          ]}
        >
          {category}
        </button>
      ))}
    </div>

    <!-- Projects Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8" id="projects-grid">
      {PROJECTS.map((project) => (
        <div data-category={project.category} class="project-card group flex flex-col rounded-xl bg-card border border-border/70 overflow-hidden hover:border-primary/50 transition-all duration-300">
          <!-- Image Container -->
          <div class="relative w-full aspect-video overflow-hidden">
            <div class="absolute inset-0 bg-linear-to-t from-black/70 to-transparent dark:from-black/70 z-10 opacity-60 group-hover:opacity-40 transition-opacity"></div>
            <img 
              src={project.image} 
              alt={project.title}
              class="w-full h-full object-cover transition-transform duration-500"
            />
            <div class="absolute bottom-4 left-4 z-20">
              <span class="px-3 py-1 rounded-full bg-primary/90 text-primary-foreground text-xs font-bold shadow-sm backdrop-blur-sm">
                {project.category}
              </span>
            </div>
          </div>

          <!-- Content -->
          <div class="flex flex-col flex-1 p-6">
            <h3 class="text-xl font-bold text-primary mb-2">{project.title}</h3>
            
            {(project.startDate || project.endDate) && (
              <p class="text-xs text-muted-foreground font-medium mb-3">
                {formatDate(project.startDate)}
                {project.startDate && project.endDate && ' - '}
                {formatDate(project.endDate)}
              </p>
            )}

            <p class="text-muted-foreground text-sm mb-6 flex-1 leading-relaxed">
              {project.description}
            </p>

            <div class="space-y-4">
              <div>
                <p class="text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-2">Tech Stack</p>
                <div class="flex flex-wrap gap-2">
                  {project.techStack.map((tech) => (
                    <span class="px-2.5 py-1 rounded-full bg-primary/10 text-primary text-xs font-medium">
                      {tech}
                    </span>
                  ))}
                </div>
              </div>

              <div class="pt-4 border-t border-border/60 flex justify-end gap-3">
                {project.repoUrl && (
                  <a href={project.repoUrl} target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 text-sm font-semibold text-foreground hover:text-primary transition-colors bg-card border border-border px-4 py-2 rounded-lg hover:border-primary/50 hover:bg-muted/20">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg>
                    Code
                  </a>
                )}
                {project.demoUrl && (
                  <a href={project.demoUrl} target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 text-sm font-semibold text-foreground hover:text-primary transition-colors bg-card border border-border px-4 py-2 rounded-lg hover:border-primary/50 hover:bg-muted/20">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22v-4"></path><path d="M7 12H2l10-10 10 10h-5"></path><path d="M7 12v4a4 4 0 0 0 4 4h2a4 4 0 0 0 4-4v-4"></path></svg>
                    Demo
                  </a>
                )}
                {project.reportUrl && (
                  <a href={project.reportUrl} target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 text-sm font-semibold text-foreground hover:text-primary transition-colors bg-card border border-border px-4 py-2 rounded-lg hover:border-primary/50 hover:bg-muted/20">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"></path><path d="M14 2v4a2 2 0 0 0 2 2h4"></path><path d="m16 13-3.5 3.5-2-2L8 17"></path></svg>
                    Report
                  </a>
                )}
                {!project.repoUrl && !project.demoUrl && !project.reportUrl && (
                  <span class="flex items-center gap-2 px-4 py-2 rounded-lg bg-muted text-muted-foreground text-sm font-medium cursor-not-allowed">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2"></path></svg>
                    Private
                  </span>
                )}
              </div>
            </div>
          </div>
        </div>
      ))}
    </div>
  </div>
</Layout>

<script>
  function setupFilters() {
    const filterBtns = document.querySelectorAll('.filter-btn');
    const projectCards = document.querySelectorAll('.project-card');

    filterBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const category = btn.getAttribute('data-category');
        
        // Update button styles
        filterBtns.forEach(b => {
          b.classList.remove('bg-primary', 'text-primary-foreground', 'shadow-lg', 'shadow-primary/25');
          b.classList.add('bg-card', 'text-muted-foreground', 'hover:bg-muted/60', 'hover:text-foreground');
        });
        btn.classList.remove('bg-card', 'text-muted-foreground', 'hover:bg-muted/60', 'hover:text-foreground');
        btn.classList.add('bg-primary', 'text-primary-foreground', 'shadow-lg', 'shadow-primary/25');

        // Filter cards
        projectCards.forEach(card => {
          const cardCategory = card.getAttribute('data-category');
          if (category === 'All' || cardCategory === category) {
            (card as HTMLElement).style.display = '';
          } else {
            (card as HTMLElement).style.display = 'none';
          }
        });
      });
    });
  }

  setupFilters();
  document.addEventListener('astro:after-swap', setupFilters);
</script>
