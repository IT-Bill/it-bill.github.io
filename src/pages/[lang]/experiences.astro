---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import { useTranslations } from '../../i18n';
import type { Lang } from '../../i18n';

export function getStaticPaths() {
  return [
    { params: { lang: 'en' } },
    { params: { lang: 'zh' } },
  ];
}

const { lang } = Astro.params as { lang: Lang };
const t = useTranslations(lang);

const expEntries = (await getCollection('experiences')).filter(e => e.id.endsWith(`/${lang}`));
const EXPERIENCE = expEntries
  .sort((a, b) => a.data.order - b.data.order)
  .map(e => ({ id: e.id, ...e.data }));

type ExperienceType = 'education' | 'work' | 'research';

function getIconSvg(type: ExperienceType): string {
  switch (type) {
    case 'education':
      return '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z"></path><path d="M22 10v6"></path><path d="M6 12.5V16a6 3 0 0 0 12 0v-3.5"></path></svg>';
    case 'work':
      return '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path><rect width="20" height="14" x="2" y="6" rx="2"></rect></svg>';
    case 'research':
      return '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2"></path><path d="M8.5 2h7"></path><path d="M7 16h10"></path></svg>';
    default:
      return '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"></path></svg>';
  }
}
---

<Layout title={`${t('experiences.title')} - ${t('site.title')}`} lang={lang}>
  <div class="w-full">
    <section class="bg-linear-to-b from-background via-background/95 to-background px-4 md:px-8 py-12 md:py-20">
      <div class="container mx-auto max-w-6xl">

        <div class="relative border-l border-border-dark ml-3 md:ml-6 space-y-12 pb-4">
          {EXPERIENCE.map((exp) => (
            <article class="relative pl-8 md:pl-12 group">
              <div class="absolute -left-5 top-0 h-10 w-10 rounded-full border-2 border-primary/40 flex items-center justify-center text-primary backdrop-blur">
                <Fragment set:html={getIconSvg(exp.type)} />
              </div>

              <div class="flex flex-col gap-2">
                <h3 class="text-2xl font-bold text-foreground group-hover:text-primary transition-colors">
                  {exp.title}
                </h3>
                <div class="flex flex-wrap items-center gap-3 text-sm font-semibold text-primary">
                  <span class="inline-flex items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 2v4"></path><path d="M16 2v4"></path><rect width="18" height="18" x="3" y="4" rx="2"></rect><path d="M3 10h18"></path></svg>
                    {exp.period}
                  </span>
                  <span class="inline-flex items-center gap-1 text-muted-foreground">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                    {exp.institution}
                  </span>
                </div>
                <p class="text-muted-foreground text-sm leading-relaxed max-w-3xl whitespace-pre-line">
                  {exp.description}
                </p>

                <div class="flex flex-wrap gap-2">
                  {exp.tags.map((tag) => (
                    <span class="px-2 py-0.5 rounded text-xs font-medium bg-card border border-border/60 text-muted-foreground">
                      {tag}
                    </span>
                  ))}
                </div>
              </div>
            </article>
          ))}
        </div>
      </div>
    </section>
  </div>
</Layout>
