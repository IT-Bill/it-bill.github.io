---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import { useTranslations } from '../../i18n';
import type { Lang } from '../../i18n';

export function getStaticPaths() {
  return [
    { params: { lang: 'en' } },
    { params: { lang: 'zh' } },
  ];
}

const { lang } = Astro.params as { lang: Lang };
const t = useTranslations(lang);

const collectionName = lang === 'zh' ? 'publications_zh' : 'publications';
const pubEntries = await getCollection(collectionName);
const PUBLICATIONS = pubEntries
  .sort((a, b) => Number(b.data.year) - Number(a.data.year))
  .map(e => ({ id: e.id, ...e.data }));
---

<Layout title={`${t('publications.title')} - ${t('site.title')}`} lang={lang}>
  <div class="container mx-auto px-4 md:px-8 py-12">
    <div class="space-y-6">
      {PUBLICATIONS.map((pub) => (
        <div
          class="bg-card border border-border rounded-xl p-6 md:p-8 hover:border-primary/40 transition-all group shadow-sm hover:shadow-primary/5"
        >
          <div class="flex flex-col md:flex-row justify-between gap-4 mb-3">
            <h3 class="text-xl font-bold text-foreground group-hover:text-primary transition-colors">
              {pub.title}
            </h3>
            <span class="shrink-0 px-3 py-1 rounded-full bg-muted/60 text-sm font-medium text-muted-foreground border border-border/60 h-fit w-fit flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-muted-foreground"><path d="M8 2v4"></path><path d="M16 2v4"></path><rect width="18" height="18" x="3" y="4" rx="2"></rect><path d="M3 10h18"></path></svg>
              {pub.year}
            </span>
          </div>

          <div class="text-primary font-medium mb-3 flex items-center gap-2">
            <span class="bg-primary/10 px-2 py-1 rounded text-sm border border-primary/20 text-primary">
              {pub.conference}
            </span>
          </div>

          <div class="flex items-center gap-2 text-muted-foreground text-sm mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-muted-foreground"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M22 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
            <span class="italic">{pub.authors.join(", ")}</span>
          </div>

          <p class="text-muted-foreground mb-6 leading-relaxed border-l border-border/50 pl-4">
            {pub.description}
          </p>

          <div class="flex flex-wrap gap-4">
            {pub.paperUrl && (
              <a
                href={pub.paperUrl}
                target="_blank"
                rel="noopener noreferrer"
                class="flex items-center gap-2 text-sm font-semibold text-foreground hover:text-primary transition-colors bg-card border border-border px-4 py-2 rounded-lg hover:border-primary/50 hover:bg-muted/20"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"></path><path d="M14 2v4a2 2 0 0 0 2 2h4"></path><path d="M10 9H8"></path><path d="M16 13H8"></path><path d="M16 17H8"></path></svg>
                {t('publications.readPaper')}
              </a>
            )}
            {pub.repoUrl && (
              <a
                href={pub.repoUrl}
                target="_blank"
                rel="noopener noreferrer"
                class="flex items-center gap-2 text-sm font-semibold text-foreground hover:text-primary transition-colors bg-card border border-border px-4 py-2 rounded-lg hover:border-primary/50 hover:bg-muted/20"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>
                {t('publications.viewCode')}
              </a>
            )}
          </div>
        </div>
      ))}
    </div>
  </div>
</Layout>
